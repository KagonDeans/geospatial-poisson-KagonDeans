---
title: "R Notebook"
output: html_notebook
---
```{r}
library(dplyr)
library(ggplot2)
library(sf)
library(tidyverse)
library(leaflet)
```
```{r}
burglaries <- read_csv("../data/burglaries_2023.csv")
census <- read_csv("../data/census.csv", col_types = cols(state = "c", county = "c"))
census_tract <- st_read("../data/DC/DC.shp")
```
```{r}
burglaries_geo <- st_as_sf(burglaries |> drop_na(latitude),
         coords = c('longitude', 'latitude'),
         crs = st_crs(census_tract)
         )
```
```{r}
burglaries_census <- st_join(census_tract, burglaries_geo, join = st_contains)
```
```{r}
burglaries_census
```

```{r}
burglaries_census |> 
  distinct(TRACTCE) |> 
  nrow()
 
```
```{r}
str(census)
```

```{r}
str(burglaries_census)
```
```{r}
burglaries_census <- inner_join(burglaries_census, census, join_by(STATEFP == state, COUNTYFP == county, TRACTCE == tract))
```

### Part 2 - Exploratory Analysis

Perform some exploraty analysis on your prepared dataset.

Aggregate the data by census tract. **Warning:** each incident can appear multiple times if there are multiple victims, so be sure that you aren't double-counting any incidents. 

Which census tract had the highest number of burglaries? Which census tract had the highest number of burglaries per 1000 residents? 

We're interested in the relationship between median income and number of aggravated burglaries, so examine those variables on their own and together to see what you can find. You may want to perform additional calculations, create plots, etc.


```{r}
burglaries_census |> 
  st_drop_geometry() |>
  group_by(TRACTCE) |> 
  distinct(incident_number) |>
  count(name = "num_incidents") |> 
  arrange(num_incidents)
```
```{r}
burglaries_census |> 
  st_drop_geometry() |>
  group_by(TRACTCE) |> 
  distinct(incident_number) |>
  count(name = "num_incidents") |> 
  arrange(desc(num_incidents))
```



